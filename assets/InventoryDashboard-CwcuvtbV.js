import{c as j,r as n,H as V,s as w,j as e,C as R,S as $,X as C}from"./index-BEXsge0c.js";const H=j("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),_=j("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),T=j("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),z=j("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),I=({onLogout:f})=>{const[x,l]=n.useState("scan"),[p,v]=n.useState(""),[r,m]=n.useState(null),[b,c]=n.useState(!1),[u,k]=n.useState(1),[g,o]=n.useState(null),[t,d]=n.useState({category:"perfume",gender:"unisex",cost_price:0,sale_price:0,stock:0}),h=n.useRef(null);n.useEffect(()=>(x==="scan"?setTimeout(()=>M(),100):N(),()=>N()),[x]);const M=()=>{if(h.current)return;const s=new V("reader",{fps:10,qrbox:250},!1);s.render(P,q),h.current=s},N=()=>{h.current&&(h.current.clear().catch(s=>console.error("Error clearing scanner",s)),h.current=null)},P=(s,a)=>{y(s),N()},q=s=>{},y=async s=>{c(!0),o(null),v(s);try{const{data:a,error:i}=await w.from("products").select("*").eq("barcode",s).single();if(i&&i.code!=="PGRST116")throw i;a?(m(a),l("product_details")):(m(null),d(L=>({...L,barcode:s,name:""})),l("new_product"))}catch(a){o({type:"error",text:a.message})}finally{c(!1)}},A=async s=>{s.preventDefault(),c(!0);try{if(!t.name||!t.sale_price)throw new Error("Faltan datos obligatorios");const{data:a,error:i}=await w.from("products").insert([t]).select().single();if(i)throw i;m(a),l("product_details"),o({type:"success",text:"Producto registrado correctamente"})}catch(a){o({type:"error",text:a.message})}finally{c(!1)}},E=async()=>{if(r){c(!0);try{const{error:s}=await w.from("inventory_requests").insert({product_id:r.id,quantity:-u,status:"pending"});if(s)throw s;o({type:"success",text:"Venta solicitada. Esperando validación del Admin."}),setTimeout(()=>{l("scan"),v(""),m(null),o(null)},2e3)}catch(s){o({type:"error",text:s.message})}finally{c(!1)}}},S=t.sale_price&&t.cost_price?((t.sale_price-t.cost_price)/t.sale_price*100).toFixed(1):"0.0";return e.jsxs("div",{className:"min-h-screen bg-stone-100 pb-20",children:[e.jsxs("div",{className:"bg-stone-900 text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-amber-500/20 p-2 rounded-lg",children:e.jsx(z,{className:"text-amber-500",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg leading-none",children:"Inventario"}),e.jsx("p",{className:"text-[10px] text-stone-400",children:"Scanner & Control"})]})]}),e.jsx("button",{onClick:f,className:"text-stone-400 hover:text-white p-2",children:e.jsx(T,{size:20})})]}),e.jsxs("div",{className:"max-w-md mx-auto p-4 space-y-4",children:[g&&e.jsxs("div",{className:`p-4 rounded-xl flex items-center gap-3 ${g.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[g.type==="success"?e.jsx(R,{size:20}):e.jsx(H,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:g.text})]}),x==="scan"&&e.jsx("div",{className:"space-y-6 animate-in slide-in-from-bottom duration-500",children:e.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-lg border border-stone-200 text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-stone-100 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(z,{size:32,className:"text-stone-400"})}),e.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Escanear Producto"}),e.jsx("p",{className:"text-sm text-stone-500",children:"Apunta la cámara al código de barras"}),e.jsx("div",{id:"reader",className:"overflow-hidden rounded-xl border-2 border-dashed border-stone-300 bg-black/5 min-h-[250px]"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-stone-200"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-stone-400",children:"O ingresa código manual"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"123456789",value:p,onChange:s=>v(s.target.value),className:"flex-1 bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 text-center tracking-widest font-mono text-lg outline-none focus:ring-2 focus:ring-black",onKeyDown:s=>s.key==="Enter"&&y(p)}),e.jsx("button",{onClick:()=>y(p),className:"bg-stone-900 text-white p-3 rounded-xl hover:bg-black transition",children:e.jsx($,{size:24})})]})]})}),x==="new_product"&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"bg-amber-500 p-6 text-white text-center relative connection-pattern",children:[e.jsx("button",{onClick:()=>l("scan"),className:"absolute left-4 top-4 p-2 bg-black/10 rounded-full hover:bg-black/20 transition",children:e.jsx(C,{size:20})}),e.jsx(D,{className:"mx-auto w-12 h-12 mb-2 text-white/90"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Nuevo Producto"}),e.jsxs("p",{className:"text-amber-100 text-sm",children:["Código: ",p]})]}),e.jsxs("form",{onSubmit:A,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Nombre Producto"}),e.jsx("input",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 font-medium outline-none focus:border-amber-500",value:t.name||"",onChange:s=>d({...t,name:s.target.value}),placeholder:"Ej: Lattafa Asad 100ml",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Categoría"}),e.jsxs("select",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none",value:t.category,onChange:s=>d({...t,category:s.target.value}),children:[e.jsx("option",{value:"perfume",children:"Perfume"}),e.jsx("option",{value:"desodorante",children:"Desodorante"}),e.jsx("option",{value:"capilar",children:"Capilar"}),e.jsx("option",{value:"otro",children:"Otro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Género"}),e.jsxs("select",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none",value:t.gender,onChange:s=>d({...t,gender:s.target.value}),children:[e.jsx("option",{value:"unisex",children:"Unisex"}),e.jsx("option",{value:"hombre",children:"Hombre"}),e.jsx("option",{value:"mujer",children:"Mujer"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Costo ($)"}),e.jsx("input",{type:"number",className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none",value:t.cost_price||"",onChange:s=>d({...t,cost_price:Number(s.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Venta ($)"}),e.jsx("input",{type:"number",className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none font-bold text-stone-800",value:t.sale_price||"",onChange:s=>d({...t,sale_price:Number(s.target.value)}),required:!0})]})]}),e.jsxs("div",{className:"bg-stone-50 p-4 rounded-xl flex justify-between items-center border border-stone-100",children:[e.jsx("span",{className:"text-xs font-bold text-stone-500 uppercase",children:"Margen Calculado"}),e.jsxs("span",{className:`font-bold text-lg ${Number(S)>30?"text-green-600":"text-orange-500"}`,children:[S,"%"]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",disabled:b,className:"w-full bg-stone-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-black transition shadow-lg disabled:opacity-50",children:b?"Guardando...":"Guardar Producto"})})]})]}),x==="product_details"&&r&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"h-40 bg-stone-900 relative",children:[e.jsx("button",{onClick:()=>l("scan"),className:"absolute left-4 top-4 p-2 bg-white/10 rounded-full hover:bg-white/20 text-white transition",children:e.jsx(C,{size:20})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(_,{size:64,className:"text-stone-700"})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent text-white",children:[e.jsx("span",{className:"inline-block px-2 py-1 bg-amber-500 text-[10px] font-bold uppercase rounded mb-2 text-black",children:r.category}),e.jsx("h2",{className:"text-2xl font-bold leading-tight",children:r.name})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-stone-50 p-4 rounded-xl border border-stone-100",children:[e.jsx("div",{className:"text-xs text-stone-400 uppercase font-bold mb-1",children:"Precio"}),e.jsxs("div",{className:"text-xl font-bold text-stone-900",children:["$",r.sale_price.toLocaleString()]})]}),e.jsxs("div",{className:"bg-stone-50 p-4 rounded-xl border border-stone-100",children:[e.jsx("div",{className:"text-xs text-stone-400 uppercase font-bold mb-1",children:"Stock"}),e.jsx("div",{className:"text-xl font-bold text-stone-900",children:r.stock})]})]}),e.jsxs("div",{className:"border-t border-stone-100 pt-6",children:[e.jsxs("h3",{className:"font-bold text-stone-800 mb-4 flex items-center gap-2",children:[e.jsx(_,{size:18})," Registrar Venta Manual"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>k(Math.max(1,u-1)),className:"w-10 h-10 rounded-xl border border-stone-200 flex items-center justify-center hover:bg-stone-50",children:"-"}),e.jsx("span",{className:"text-xl font-bold w-8 text-center",children:u}),e.jsx("button",{onClick:()=>k(u+1),className:"w-10 h-10 rounded-xl border border-stone-200 flex items-center justify-center hover:bg-stone-50",children:"+"})]}),e.jsx("button",{onClick:E,disabled:b,className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 transition shadow-lg shadow-green-200 disabled:opacity-50",children:b?"Procesando...":`Solicitar Venta ($${(r.sale_price*u).toLocaleString()})`}),e.jsx("p",{className:"text-xs text-stone-400 text-center mt-3",children:"Requiere validación del administrador para ajuste de stock final."})]})]})]})]})]})},D=({className:f})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:f,children:[e.jsx("path",{d:"M16.5 9.4 7.5 4.21"}),e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.29 7 12 12 20.71 7"}),e.jsx("line",{x1:"12",y1:"22",x2:"12",y2:"12"})]});export{I as default};
