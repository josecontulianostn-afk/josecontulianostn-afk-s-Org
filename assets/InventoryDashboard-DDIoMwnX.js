import{c as h,r as a,s as v,j as e,C as K,S as W,X as E,H as _}from"./index-pwjlVvoi.js";const I=h("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),A=h("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),X=h("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Z=h("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),J=h("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Y=h("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),ee=h("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),V=h("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),re=({onLogout:N})=>{const[o,c]=a.useState("scan"),[b,w]=a.useState(""),[i,g]=a.useState(null),[f,d]=a.useState(!1),[m,z]=a.useState(1),[j,x]=a.useState(null),[p,$]=a.useState([]),[M,k]=a.useState(!1),[C,S]=a.useState(null),[r,u]=a.useState({category:"perfume",gender:"unisex",cost_price:0,sale_price:0,stock:0}),L=a.useRef(null),l=a.useRef(null);a.useEffect(()=>()=>{l.current&&l.current.isScanning&&l.current.stop().catch(t=>console.error(t))},[]),a.useEffect(()=>{o==="list"&&R()},[o]);const R=async()=>{d(!0);try{const{data:t,error:s}=await v.from("products").select("*").order("name",{ascending:!0});if(s)throw s;$(t||[])}catch(t){console.error("Error fetching inventory",t)}finally{d(!1)}},P=async()=>{S(null);try{l.current||(l.current=new _("reader"));const t=await _.getCameras();if(t&&t.length){const s=t.length>1?t[1].id:t[0].id;await l.current.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},n=>{F(n)},n=>{}),k(!0)}else S("No se encontraron cámaras.")}catch(t){console.error(t),S("Error al iniciar cámara: "+t.message),k(!1)}},H=async()=>{if(l.current&&M)try{await l.current.stop(),k(!1)}catch(t){console.error("Failed to stop scanner",t)}},F=async t=>{await H(),y(t)},D=t=>{if(t.target.files&&t.target.files.length>0){const s=t.target.files[0];l.current||(l.current=new _("reader")),l.current.scanFile(s,!0).then(n=>{y(n)}).catch(n=>{x({type:"error",text:"No se pudo leer el código de la imagen."})})}},y=async t=>{d(!0),x(null),w(t);try{const{data:s,error:n}=await v.from("products").select("*").eq("barcode",t).single();if(n&&n.code!=="PGRST116")throw n;s?(g(s),c("product_details")):(g(null),u(B=>({...B,barcode:t,name:"",stock:0})),c("new_product"))}catch(s){x({type:"error",text:s.message})}finally{d(!1)}},G=async t=>{t.preventDefault(),d(!0);try{if(!r.name||!r.sale_price)throw new Error("Faltan datos obligatorios");const{data:s,error:n}=await v.from("products").insert([r]).select().single();if(n)throw n;g(s),c("product_details"),x({type:"success",text:"Producto registrado correctamente"})}catch(s){x({type:"error",text:s.message})}finally{d(!1)}},O=async()=>{if(i){d(!0);try{const{error:t}=await v.from("inventory_requests").insert({product_id:i.id,quantity:-m,status:"pending"});if(t)throw t;x({type:"success",text:"Venta solicitada. Esperando validación del Admin."}),setTimeout(()=>{c("scan"),w(""),g(null),x(null)},2e3)}catch(t){x({type:"error",text:t.message})}finally{d(!1)}}},q=r.sale_price&&r.cost_price?((r.sale_price-r.cost_price)/r.sale_price*100).toFixed(1):"0.0",Q=p.reduce((t,s)=>t+(s.stock||0),0),T=p.reduce((t,s)=>t+(s.stock||0)*(s.cost_price||0),0),U=p.reduce((t,s)=>t+(s.stock||0)*(s.sale_price||0),0);return e.jsxs("div",{className:"min-h-screen bg-stone-100 pb-40",children:[e.jsxs("div",{className:"bg-stone-900 text-white p-4 flex justify-between items-center shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o!=="scan"?e.jsx("button",{onClick:()=>c("scan"),className:"bg-stone-800 p-2 rounded-full hover:bg-stone-700 transition",children:e.jsx(X,{size:20,className:"text-white"})}):e.jsx("div",{className:"bg-amber-500/20 p-2 rounded-lg",children:e.jsx(V,{className:"text-amber-500",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg leading-none",children:"Inventario"}),e.jsx("p",{className:"text-[10px] text-stone-400",children:"Scanner & Control"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o!=="list"&&e.jsx("button",{onClick:()=>c("list"),className:"text-stone-400 hover:text-white p-2",children:e.jsx(Y,{size:24})}),e.jsx("button",{onClick:N,className:"text-stone-400 hover:text-white p-2",children:e.jsx(ee,{size:20})})]})]}),e.jsxs("div",{className:"max-w-md mx-auto p-4 space-y-4",children:[j&&e.jsxs("div",{className:`p-4 rounded-xl flex items-center gap-3 ${j.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[j.type==="success"?e.jsx(K,{size:20}):e.jsx(I,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:j.text})]}),o==="scan"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-lg border border-stone-200 text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-stone-100 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(V,{size:32,className:"text-stone-400"})}),e.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Escanear Producto"}),e.jsxs("div",{className:"relative overflow-hidden rounded-xl border-2 border-dashed border-stone-300 bg-black min-h-[300px] flex flex-col justify-center",children:[e.jsx("div",{id:"reader",className:"w-full h-full"}),!M&&!C&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-stone-300/10 backdrop-blur-sm z-10",children:[e.jsxs("button",{onClick:P,className:"bg-amber-500 hover:bg-amber-600 text-white px-8 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition transform hover:scale-105",children:[e.jsx(Z,{size:20})," Activar Cámara"]}),e.jsx("p",{className:"mt-4 text-xs text-white bg-black/50 px-3 py-1 rounded-full",children:"Permite el acceso a tu cámara"})]}),C&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-red-50 p-4 z-10",children:[e.jsx(I,{className:"text-red-500 w-12 h-12 mb-2"}),e.jsx("p",{className:"text-red-600 text-center text-sm font-bold",children:C}),e.jsx("button",{onClick:P,className:"mt-4 text-stone-600 underline text-sm",children:"Intentar de nuevo"})]})]}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx("input",{type:"file",ref:L,className:"hidden",accept:"image/*",onChange:D}),e.jsxs("button",{onClick:()=>L.current?.click(),className:"text-stone-400 text-xs flex items-center gap-1 hover:text-stone-600 transition",children:[e.jsx(J,{size:14})," ¿Problemas con la cámara? ",e.jsx("span",{className:"underline",children:"Subir una foto del código"})]})]}),e.jsxs("div",{className:"relative my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-stone-200"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-stone-400",children:"O ingresar manual"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Código numérico...",value:b,onChange:t=>w(t.target.value),className:"flex-1 bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 text-center tracking-widest font-mono text-lg outline-none focus:ring-2 focus:ring-black",onKeyDown:t=>t.key==="Enter"&&y(b)}),e.jsx("button",{onClick:()=>y(b),className:"bg-stone-900 text-white p-3 rounded-xl hover:bg-black transition",children:e.jsx(W,{size:24})})]})]})}),o==="new_product"&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-amber-500 p-6 text-white text-center relative",children:[e.jsx("button",{onClick:()=>c("scan"),className:"absolute left-4 top-4 p-2 bg-black/10 rounded-full hover:bg-black/20 transition",children:e.jsx(E,{size:20})}),e.jsx(te,{className:"mx-auto w-12 h-12 mb-2 text-white/90"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Nuevo Producto"}),e.jsxs("p",{className:"text-amber-100 text-sm",children:["Código: ",b]})]}),e.jsxs("form",{onSubmit:G,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Nombre Producto"}),e.jsx("input",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 font-medium outline-none focus:border-amber-500",value:r.name||"",onChange:t=>u({...r,name:t.target.value}),placeholder:"Ej: Lattafa Asad 100ml",required:!0,autoComplete:"off"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Categoría"}),e.jsxs("select",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none",value:r.category,onChange:t=>u({...r,category:t.target.value}),children:[e.jsx("option",{value:"perfume",children:"Perfume"}),e.jsx("option",{value:"desodorante",children:"Desodorante"}),e.jsx("option",{value:"capilar",children:"Capilar"}),e.jsx("option",{value:"otro",children:"Otro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Stock Inicial"}),e.jsx("input",{type:"number",className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none font-bold text-stone-800",value:r.stock||0,onChange:t=>u({...r,stock:Number(t.target.value)}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Costo ($)"}),e.jsx("input",{type:"number",className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none",value:r.cost_price||"",onChange:t=>u({...r,cost_price:Number(t.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Venta ($)"}),e.jsx("input",{type:"number",className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none font-bold text-stone-800",value:r.sale_price||"",onChange:t=>u({...r,sale_price:Number(t.target.value)}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Género"}),e.jsxs("select",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none",value:r.gender,onChange:t=>u({...r,gender:t.target.value}),children:[e.jsx("option",{value:"unisex",children:"Unisex"}),e.jsx("option",{value:"hombre",children:"Hombre"}),e.jsx("option",{value:"mujer",children:"Mujer"})]})]}),e.jsxs("div",{className:"bg-stone-50 p-4 rounded-xl flex justify-between items-center border border-stone-100",children:[e.jsx("span",{className:"text-xs font-bold text-stone-500 uppercase",children:"Margen Calculado"}),e.jsxs("span",{className:`font-bold text-lg ${Number(q)>30?"text-green-600":"text-orange-500"}`,children:[q,"%"]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",disabled:f,className:"w-full bg-stone-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-black transition shadow-lg disabled:opacity-50",children:f?"Guardando...":"Guardar Producto"})})]})]}),o==="product_details"&&i&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"h-40 bg-stone-900 relative",children:[e.jsx("button",{onClick:()=>c("scan"),className:"absolute left-4 top-4 p-2 bg-white/10 rounded-full hover:bg-white/20 text-white transition",children:e.jsx(E,{size:20})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(A,{size:64,className:"text-stone-700"})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent text-white",children:[e.jsx("span",{className:"inline-block px-2 py-1 bg-amber-500 text-[10px] font-bold uppercase rounded mb-2 text-black",children:i.category}),e.jsx("h2",{className:"text-2xl font-bold leading-tight",children:i.name})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-stone-50 p-4 rounded-xl border border-stone-100",children:[e.jsx("div",{className:"text-xs text-stone-400 uppercase font-bold mb-1",children:"Precio"}),e.jsxs("div",{className:"text-xl font-bold text-stone-900",children:["$",i.sale_price.toLocaleString()]})]}),e.jsxs("div",{className:"bg-stone-50 p-4 rounded-xl border border-stone-100",children:[e.jsx("div",{className:"text-xs text-stone-400 uppercase font-bold mb-1",children:"Stock"}),e.jsx("div",{className:"text-xl font-bold text-stone-900",children:i.stock})]})]}),e.jsxs("div",{className:"border-t border-stone-100 pt-6",children:[e.jsxs("h3",{className:"font-bold text-stone-800 mb-4 flex items-center gap-2",children:[e.jsx(A,{size:18})," Registrar Venta Manual"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>z(Math.max(1,m-1)),className:"w-10 h-10 rounded-xl border border-stone-200 flex items-center justify-center hover:bg-stone-50",children:"-"}),e.jsx("span",{className:"text-xl font-bold w-8 text-center",children:m}),e.jsx("button",{onClick:()=>z(m+1),className:"w-10 h-10 rounded-xl border border-stone-200 flex items-center justify-center hover:bg-stone-50",children:"+"})]}),e.jsx("button",{onClick:O,disabled:f,className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 transition shadow-lg shadow-green-200 disabled:opacity-50",children:f?"Procesando...":`Solicitar Venta ($${(i.sale_price*m).toLocaleString()})`}),e.jsx("p",{className:"text-xs text-stone-400 text-center mt-3",children:"Requiere validación del administrador para ajuste de stock final."})]})]})]}),o==="list"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-sm border border-stone-100 text-center",children:[e.jsx("div",{className:"text-[10px] text-stone-400 uppercase font-bold",children:"Unidades"}),e.jsx("div",{className:"text-lg font-bold text-stone-900",children:Q})]}),e.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-sm border border-stone-100 text-center",children:[e.jsx("div",{className:"text-[10px] text-stone-400 uppercase font-bold",children:"Costo"}),e.jsxs("div",{className:"text-lg font-bold text-stone-900",children:["$",T.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-sm border border-stone-100 text-center",children:[e.jsx("div",{className:"text-[10px] text-stone-400 uppercase font-bold",children:"Venta"}),e.jsxs("div",{className:"text-lg font-bold text-stone-900",children:["$",U.toLocaleString()]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden border border-stone-100",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-stone-50 text-stone-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Producto"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Precio"})]})}),e.jsxs("tbody",{className:"divide-y divide-stone-100",children:[p.map(t=>e.jsxs("tr",{className:"hover:bg-stone-50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-bold text-stone-800",children:t.name}),e.jsx("div",{className:"text-[10px] text-stone-400",children:t.barcode})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-block px-2 py-0.5 rounded textxs font-bold ${t.stock>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.stock})}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium",children:["$",t.sale_price.toLocaleString()]})]},t.id)),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-4 py-8 text-center text-stone-400",children:"No hay productos registrados"})})]})]})})]})]})]})},te=({className:N})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:N,children:[e.jsx("path",{d:"M16.5 9.4 7.5 4.21"}),e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.29 7 12 12 20.71 7"}),e.jsx("line",{x1:"12",y1:"22",x2:"12",y2:"12"})]});export{re as default};
