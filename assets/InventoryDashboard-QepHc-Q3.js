import{c as u,r,j as e,C as G,S as O,X as E,H as C,s as S}from"./index-KPYoSPlh.js";const L=u("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),A=u("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),Q=u("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),T=u("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),B=u("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),I=u("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),W=({onLogout:j})=>{const[v,i]=r.useState("scan"),[m,y]=r.useState(""),[o,p]=r.useState(null),[b,d]=r.useState(!1),[h,z]=r.useState(1),[g,c]=r.useState(null),[_,N]=r.useState(!1),[w,k]=r.useState(null),[s,x]=r.useState({category:"perfume",gender:"unisex",cost_price:0,sale_price:0,stock:0}),M=r.useRef(null),n=r.useRef(null);r.useEffect(()=>()=>{n.current&&n.current.isScanning&&n.current.stop().catch(t=>console.error(t))},[]);const P=async()=>{k(null);try{n.current||(n.current=new C("reader"));const t=await C.getCameras();if(t&&t.length){const l=t.length>1?t[1].id:t[0].id;await n.current.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},a=>{R(a)},a=>{}),N(!0)}else k("No se encontraron cámaras.")}catch(t){console.error(t),k("Error al iniciar cámara: "+t.message),N(!1)}},V=async()=>{if(n.current&&_)try{await n.current.stop(),N(!1)}catch(t){console.error("Failed to stop scanner",t)}},R=async t=>{await V(),f(t)},$=t=>{if(t.target.files&&t.target.files.length>0){const l=t.target.files[0];n.current||(n.current=new C("reader")),n.current.scanFile(l,!0).then(a=>{f(a)}).catch(a=>{c({type:"error",text:"No se pudo leer el código de la imagen."})})}},f=async t=>{d(!0),c(null),y(t);try{const{data:l,error:a}=await S.from("products").select("*").eq("barcode",t).single();if(a&&a.code!=="PGRST116")throw a;l?(p(l),i("product_details")):(p(null),x(D=>({...D,barcode:t,name:""})),i("new_product"))}catch(l){c({type:"error",text:l.message})}finally{d(!1)}},F=async t=>{t.preventDefault(),d(!0);try{if(!s.name||!s.sale_price)throw new Error("Faltan datos obligatorios");const{data:l,error:a}=await S.from("products").insert([s]).select().single();if(a)throw a;p(l),i("product_details"),c({type:"success",text:"Producto registrado correctamente"})}catch(l){c({type:"error",text:l.message})}finally{d(!1)}},H=async()=>{if(o){d(!0);try{const{error:t}=await S.from("inventory_requests").insert({product_id:o.id,quantity:-h,status:"pending"});if(t)throw t;c({type:"success",text:"Venta solicitada. Esperando validación del Admin."}),setTimeout(()=>{i("scan"),y(""),p(null),c(null)},2e3)}catch(t){c({type:"error",text:t.message})}finally{d(!1)}}},q=s.sale_price&&s.cost_price?((s.sale_price-s.cost_price)/s.sale_price*100).toFixed(1):"0.0";return e.jsxs("div",{className:"min-h-screen bg-stone-100 pb-20",children:[e.jsxs("div",{className:"bg-stone-900 text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-amber-500/20 p-2 rounded-lg",children:e.jsx(I,{className:"text-amber-500",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg leading-none",children:"Inventario"}),e.jsx("p",{className:"text-[10px] text-stone-400",children:"Scanner & Control"})]})]}),e.jsx("button",{onClick:j,className:"text-stone-400 hover:text-white p-2",children:e.jsx(B,{size:20})})]}),e.jsxs("div",{className:"max-w-md mx-auto p-4 space-y-4",children:[g&&e.jsxs("div",{className:`p-4 rounded-xl flex items-center gap-3 ${g.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[g.type==="success"?e.jsx(G,{size:20}):e.jsx(L,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:g.text})]}),v==="scan"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-lg border border-stone-200 text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-stone-100 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(I,{size:32,className:"text-stone-400"})}),e.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Escanear Producto"}),e.jsxs("div",{className:"relative overflow-hidden rounded-xl border-2 border-dashed border-stone-300 bg-black min-h-[300px] flex flex-col justify-center",children:[e.jsx("div",{id:"reader",className:"w-full h-full"}),!_&&!w&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-stone-300/10 backdrop-blur-sm z-10",children:[e.jsxs("button",{onClick:P,className:"bg-amber-500 hover:bg-amber-600 text-white px-8 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition transform hover:scale-105",children:[e.jsx(Q,{size:20})," Activar Cámara"]}),e.jsx("p",{className:"mt-4 text-xs text-white bg-black/50 px-3 py-1 rounded-full",children:"Permite el acceso a tu cámara"})]}),w&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-red-50 p-4 z-10",children:[e.jsx(L,{className:"text-red-500 w-12 h-12 mb-2"}),e.jsx("p",{className:"text-red-600 text-center text-sm font-bold",children:w}),e.jsx("button",{onClick:P,className:"mt-4 text-stone-600 underline text-sm",children:"Intentar de nuevo"})]})]}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx("input",{type:"file",ref:M,className:"hidden",accept:"image/*",onChange:$}),e.jsxs("button",{onClick:()=>M.current?.click(),className:"text-stone-400 text-xs flex items-center gap-1 hover:text-stone-600 transition",children:[e.jsx(T,{size:14})," ¿Problemas con la cámara? ",e.jsx("span",{className:"underline",children:"Subir una foto del código"})]})]}),e.jsxs("div",{className:"relative my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-stone-200"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-stone-400",children:"O ingresar manual"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Código numérico...",value:m,onChange:t=>y(t.target.value),className:"flex-1 bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 text-center tracking-widest font-mono text-lg outline-none focus:ring-2 focus:ring-black",onKeyDown:t=>t.key==="Enter"&&f(m)}),e.jsx("button",{onClick:()=>f(m),className:"bg-stone-900 text-white p-3 rounded-xl hover:bg-black transition",children:e.jsx(O,{size:24})})]})]})}),v==="new_product"&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-amber-500 p-6 text-white text-center relative",children:[e.jsx("button",{onClick:()=>i("scan"),className:"absolute left-4 top-4 p-2 bg-black/10 rounded-full hover:bg-black/20 transition",children:e.jsx(E,{size:20})}),e.jsx(U,{className:"mx-auto w-12 h-12 mb-2 text-white/90"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Nuevo Producto"}),e.jsxs("p",{className:"text-amber-100 text-sm",children:["Código: ",m]})]}),e.jsxs("form",{onSubmit:F,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Nombre Producto"}),e.jsx("input",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 font-medium outline-none focus:border-amber-500",value:s.name||"",onChange:t=>x({...s,name:t.target.value}),placeholder:"Ej: Lattafa Asad 100ml",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Categoría"}),e.jsxs("select",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none",value:s.category,onChange:t=>x({...s,category:t.target.value}),children:[e.jsx("option",{value:"perfume",children:"Perfume"}),e.jsx("option",{value:"desodorante",children:"Desodorante"}),e.jsx("option",{value:"capilar",children:"Capilar"}),e.jsx("option",{value:"otro",children:"Otro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Género"}),e.jsxs("select",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none",value:s.gender,onChange:t=>x({...s,gender:t.target.value}),children:[e.jsx("option",{value:"unisex",children:"Unisex"}),e.jsx("option",{value:"hombre",children:"Hombre"}),e.jsx("option",{value:"mujer",children:"Mujer"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Costo ($)"}),e.jsx("input",{type:"number",className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none",value:s.cost_price||"",onChange:t=>x({...s,cost_price:Number(t.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-500 uppercase mb-1",children:"Venta ($)"}),e.jsx("input",{type:"number",className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 outline-none font-bold text-stone-800",value:s.sale_price||"",onChange:t=>x({...s,sale_price:Number(t.target.value)}),required:!0})]})]}),e.jsxs("div",{className:"bg-stone-50 p-4 rounded-xl flex justify-between items-center border border-stone-100",children:[e.jsx("span",{className:"text-xs font-bold text-stone-500 uppercase",children:"Margen Calculado"}),e.jsxs("span",{className:`font-bold text-lg ${Number(q)>30?"text-green-600":"text-orange-500"}`,children:[q,"%"]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",disabled:b,className:"w-full bg-stone-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-black transition shadow-lg disabled:opacity-50",children:b?"Guardando...":"Guardar Producto"})})]})]}),v==="product_details"&&o&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"h-40 bg-stone-900 relative",children:[e.jsx("button",{onClick:()=>i("scan"),className:"absolute left-4 top-4 p-2 bg-white/10 rounded-full hover:bg-white/20 text-white transition",children:e.jsx(E,{size:20})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(A,{size:64,className:"text-stone-700"})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent text-white",children:[e.jsx("span",{className:"inline-block px-2 py-1 bg-amber-500 text-[10px] font-bold uppercase rounded mb-2 text-black",children:o.category}),e.jsx("h2",{className:"text-2xl font-bold leading-tight",children:o.name})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-stone-50 p-4 rounded-xl border border-stone-100",children:[e.jsx("div",{className:"text-xs text-stone-400 uppercase font-bold mb-1",children:"Precio"}),e.jsxs("div",{className:"text-xl font-bold text-stone-900",children:["$",o.sale_price.toLocaleString()]})]}),e.jsxs("div",{className:"bg-stone-50 p-4 rounded-xl border border-stone-100",children:[e.jsx("div",{className:"text-xs text-stone-400 uppercase font-bold mb-1",children:"Stock"}),e.jsx("div",{className:"text-xl font-bold text-stone-900",children:o.stock})]})]}),e.jsxs("div",{className:"border-t border-stone-100 pt-6",children:[e.jsxs("h3",{className:"font-bold text-stone-800 mb-4 flex items-center gap-2",children:[e.jsx(A,{size:18})," Registrar Venta Manual"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>z(Math.max(1,h-1)),className:"w-10 h-10 rounded-xl border border-stone-200 flex items-center justify-center hover:bg-stone-50",children:"-"}),e.jsx("span",{className:"text-xl font-bold w-8 text-center",children:h}),e.jsx("button",{onClick:()=>z(h+1),className:"w-10 h-10 rounded-xl border border-stone-200 flex items-center justify-center hover:bg-stone-50",children:"+"})]}),e.jsx("button",{onClick:H,disabled:b,className:"w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 transition shadow-lg shadow-green-200 disabled:opacity-50",children:b?"Procesando...":`Solicitar Venta ($${(o.sale_price*h).toLocaleString()})`}),e.jsx("p",{className:"text-xs text-stone-400 text-center mt-3",children:"Requiere validación del administrador para ajuste de stock final."})]})]})]})]})]})},U=({className:j})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:j,children:[e.jsx("path",{d:"M16.5 9.4 7.5 4.21"}),e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.29 7 12 12 20.71 7"}),e.jsx("line",{x1:"12",y1:"22",x2:"12",y2:"12"})]});export{W as default};
